!function(a,b){"function"==typeof define&&define.amd?define(["$"],b):"object"==typeof exports?module.exports=b():a.Dialog=b(window.Zepto||window.jQuery||$)}(this,function(a){a.fn.Dialog=function(c){var d=[];return a(this).each(function(){var e=new b,f=a.extend({trigger:a(this)},c);e.init(f),d.push(e)}),d},a.Dialog=function(c){if("alert"===c.type){var d=new b,e='<div class="ui-alert-title">'+c.content+"</div>",f="";c.button?("boolean"==typeof c.button&&(c.button="确定"),f='<p class="ui-dialog-action"><button class="ui-alert-submit  js-dialog-close">'+c.button+"</button></p>"):c.timer||(c.timer=3e3),e+=f;var g=a.extend({target:e,animate:!0,show:!0,mask:!0,className:"ui-alert",afterHide:function(a){this.dispose(),c.callback&&c.callback()}},c);d.init(g),c.timer&&setTimeout(function(){d.dispose(),c.callback&&c.callback()},c.timer),d.touch(d.mask,function(){d.hide(),c.callback&&c.callback()})}if("confirm"===c.type){var h=new b,e='<div class="ui-confirm-title">'+c.content+"</div>",f="";c.buttons||(c.buttons=[{yes:"确定"},{no:"取消"}]);for(var i="",j=0,k=c.buttons.length;k>j;j++){var l=c.buttons[j];l.yes&&(i+='<td><button class="ui-confirm-submit " data-type="yes">'+l.yes+"</button></td>"),l.no&&(i+='<td><button class="ui-confirm-no" data-type="no">'+l.no+"</button></td>"),l.close&&(i+='<td><button class="ui-confirm-close js-dialog-close" data-type="close">'+l.close+"</button></td>")}f='<table class="ui-dialog-action"><tr>'+i+"</tr></table>",e+=f;var m=a.extend({target:e,animate:!0,show:!0,fixed:!0,mask:!0,className:"ui-alert",afterHide:function(a){this.dispose()},beforeShow:function(b){h.touch(a(".ui-confirm-submit",b),function(){c.callback&&c.callback.call(h,"yes",b)}),h.touch(a(".ui-confirm-no",b),function(){c.callback&&c.callback.call(h,"no",b)}),h.touch(a(".ui-confirm-close",b),function(){c.callback&&c.callback.call(h,"close",b)})}},c);h.init(m)}},a.alert=function(b,c,d,e,f){var g={},h={zIndex:100,type:"alert"};g="object"==typeof b?a.extend(h,b):a.extend(h,{content:b,button:c,timer:e,callback:d}),a.Dialog(a.extend(g,f))},a.confirm=function(b,c,d,e){var f={},g={zIndex:100,type:"confirm"};f="object"==typeof b?a.extend(g,b):a.extend(g,{content:b,buttons:c,callback:d}),a.Dialog(a.extend(f,e))};var b=function(){var b=Math.random().toString().replace(".","");this.id="dialog_"+b,this.settings={},this.settings.closeTpl=a('<span class="ui-dialog-close js-dialog-close">x</span>'),this.settings.titleTpl=a('<div class="ui-dialog-title"></div>'),this.timer=null,this.showed=!1,this.mask=a()};return b.prototype={init:function(b){this.settings=a.extend({fixed:!1},this.settings,b),this.settings.mask&&(this.mask=a('<div class="ui-dialog-mask"/>'),a("body").append(this.mask)),a("body").append('<div class="ui-dialog" id="'+this.id+'"></div>'),this.dialogContainer=a("#"+this.id);var c=this.settings.zIndex||10;this.dialogContainer.css({zIndex:c}),this.settings.className&&this.dialogContainer.addClass(this.settings.className),this.mask.css({zIndex:c-1}),this.settings.closeTpl&&this.dialogContainer.append(this.settings.closeTpl),this.settings.title&&(this.dialogContainer.append(this.settings.titleTpl),this.settings.titleTpl.html(this.settings.title)),this.bindEvent(),this.settings.show&&this.show()},touch:function(b,c){function d(a){return c.call(this,a)}var e;a(b).on("click",d),a(b).on("touchmove",function(a){e=!0}).on("touchend",function(a){if(a.preventDefault(),!e){var b=c.call(this,a,"touch");b||(a.preventDefault(),a.stopPropagation())}e=!1})},bindEvent:function(){var b=this;this.settings.trigger&&(a(this.settings.trigger).click(function(){b.show()}),b.touch(a(this.settings.trigger),function(){b.show()})),a(this.dialogContainer).on("click",".js-dialog-close",function(){return b.hide(),!1}),a(document).keydown(function(a){27===a.keyCode&&b.showed&&b.hide()}),a(this.dialogContainer).on("hide",function(){b.hide()})},dispose:function(){this.dialogContainer.remove(),this.mask.remove(),this.timer&&clearInterval(this.timer)},hide:function(){var b=this;b.settings.beforeHide&&b.settings.beforeHide.call(b,b.dialogContainer),this.showed=!1,this.mask.hide(),this.timer&&clearInterval(this.timer),this.settings.animate?(this.dialogContainer.removeClass("zoomIn").addClass("zoomOut"),setTimeout(function(){b.dialogContainer.hide(),"object"==typeof b.settings.target&&a("body").append(b.dialogContainer.hide()),b.settings.afterHide&&b.settings.afterHide.call(b,b.dialogContainer)},500)):(this.dialogContainer.hide(),"object"==typeof this.settings.target&&a("body").append(this.dialogContainer),this.settings.afterHide&&this.settings.afterHide.call(this,this.dialogContainer))},show:function(){"string"==typeof this.settings.target?/^(\.|\#\w+)/gi.test(this.settings.target)?this.dailogContent=a(this.settings.target):this.dailogContent=a("<div>"+this.settings.target+"</div>"):this.dailogContent=this.settings.target,this.mask.show(),this.dailogContent.show(),this.height=this.settings.height||"auto",this.width=this.settings.width||"auto",this.dialogContainer.append(this.dailogContent).show().css({height:this.height,width:this.width}),this.settings.beforeShow&&this.settings.beforeShow.call(this,this.dialogContainer),this.showed=!0,a(this.settings.trigger).blur(),this.setPosition();var b=this;this.timer&&clearInterval(this.timer),this.settings.fixed&&(this.timer=setInterval(function(){b.setPosition()},1e3)),this.settings.animate&&this.dialogContainer.addClass("zoomIn").removeClass("zoomOut").addClass("animated")},setPosition:function(){if(this.showed){var a=this;this.dialogContainer.show(),this.height=this.settings.height,this.width=this.settings.width,isNaN(this.height)&&(this.height=this.dialogContainer.outerHeight&&this.dialogContainer.outerHeight()||this.dialogContainer.height()),isNaN(this.width)&&(this.width=this.dialogContainer.outerWidth&&this.dialogContainer.outerWidth()||this.dialogContainer.width());var b=this.settings.clientHeight||document.documentElement.clientHeight||document.body.clientHeight,c=this.settings.clientWidth||document.documentElement.clientWidth||document.body.clientWidth,d=this.width/2,e=this.height/2,f=c/2-d,g=b/2-e;f=Math.floor(Math.max(0,f)),g=Math.floor(Math.max(0,g));var h="absolute";a.settings.fixed&&(h="fixed"),a.dialogContainer.css({position:h,top:g,left:f})}}},b});
!function($){for(var supportedCSS,supportedCSSOrigin,styles=document.getElementsByTagName("head")[0].style,toCheck="transformProperty WebkitTransform OTransform msTransform MozTransform".split(" "),a=0;a<toCheck.length;a++)void 0!==styles[toCheck[a]]&&(supportedCSS=toCheck[a]);supportedCSS&&(supportedCSSOrigin=supportedCSS.replace(/[tT]ransform/,"TransformOrigin"),"T"==supportedCSSOrigin[0]&&(supportedCSSOrigin[0]="t")),eval('IE = "v"=="\x0B"'),jQuery.fn.extend({rotate:function(a){if(0!==this.length&&"undefined"!=typeof a){"number"==typeof a&&(a={angle:a});for(var b=[],c=0,d=this.length;d>c;c++){var e=this.get(c);if(e.Wilq32&&e.Wilq32.PhotoEffect)e.Wilq32.PhotoEffect._handleRotation(a);else{var f=$.extend(!0,{},a),g=new Wilq32.PhotoEffect(e,f)._rootObj;b.push($(g))}}return b}},getRotateAngle:function(){for(var a=[],b=0,c=this.length;c>b;b++){var d=this.get(b);d.Wilq32&&d.Wilq32.PhotoEffect&&(a[b]=d.Wilq32.PhotoEffect._angle)}return a},stopRotate:function(){for(var a=0,b=this.length;b>a;a++){var c=this.get(a);c.Wilq32&&c.Wilq32.PhotoEffect&&clearTimeout(c.Wilq32.PhotoEffect._timer)}}}),Wilq32=window.Wilq32||{},Wilq32.PhotoEffect=function(){return supportedCSS?function(a,b){a.Wilq32={PhotoEffect:this},this._img=this._rootObj=this._eventObj=a,this._handleRotation(b)}:function(a,b){if(this._img=a,this._onLoadDelegate=[b],this._rootObj=document.createElement("span"),this._rootObj.style.display="inline-block",this._rootObj.Wilq32={PhotoEffect:this},a.parentNode.insertBefore(this._rootObj,a),a.complete)this._Loader();else{var c=this;jQuery(this._img).bind("load",function(){c._Loader()})}}}(),Wilq32.PhotoEffect.prototype={_setupParameters:function(a){this._parameters=this._parameters||{},"number"!=typeof this._angle&&(this._angle=0),"number"==typeof a.angle&&(this._angle=a.angle),this._parameters.animateTo="number"==typeof a.animateTo?a.animateTo:this._angle,this._parameters.step=a.step||this._parameters.step||null,this._parameters.easing=a.easing||this._parameters.easing||this._defaultEasing,this._parameters.duration=a.duration||this._parameters.duration||1e3,this._parameters.callback=a.callback||this._parameters.callback||this._emptyFunction,this._parameters.center=a.center||this._parameters.center||["50%","50%"],"string"==typeof this._parameters.center[0]?this._rotationCenterX=parseInt(this._parameters.center[0],10)/100*this._imgWidth*this._aspectW:this._rotationCenterX=this._parameters.center[0],"string"==typeof this._parameters.center[1]?this._rotationCenterY=parseInt(this._parameters.center[1],10)/100*this._imgHeight*this._aspectH:this._rotationCenterY=this._parameters.center[1],a.bind&&a.bind!=this._parameters.bind&&this._BindEvents(a.bind)},_emptyFunction:function(){},_defaultEasing:function(a,b,c,d,e){return-d*((b=b/e-1)*b*b*b-1)+c},_handleRotation:function(a,b){return supportedCSS||this._img.complete||b?(this._setupParameters(a),void(this._angle==this._parameters.animateTo?this._rotate(this._angle):this._animateStart())):void this._onLoadDelegate.push(a)},_BindEvents:function(a){if(a&&this._eventObj){if(this._parameters.bind){var b=this._parameters.bind;for(var c in b)b.hasOwnProperty(c)&&jQuery(this._eventObj).unbind(c,b[c])}this._parameters.bind=a;for(var c in a)a.hasOwnProperty(c)&&jQuery(this._eventObj).bind(c,a[c])}},_Loader:function(){return IE?function(){var a=this._img.width,b=this._img.height;this._imgWidth=a,this._imgHeight=b,this._img.parentNode.removeChild(this._img),this._vimage=this.createVMLNode("image"),this._vimage.src=this._img.src,this._vimage.style.height=b+"px",this._vimage.style.width=a+"px",this._vimage.style.position="absolute",this._vimage.style.top="0px",this._vimage.style.left="0px",this._aspectW=this._aspectH=1,this._container=this.createVMLNode("group"),this._container.style.width=a,this._container.style.height=b,this._container.style.position="absolute",this._container.style.top="0px",this._container.style.left="0px",this._container.setAttribute("coordsize",a-1+","+(b-1)),this._container.appendChild(this._vimage),this._rootObj.appendChild(this._container),this._rootObj.style.position="relative",this._rootObj.style.width=a+"px",this._rootObj.style.height=b+"px",this._rootObj.setAttribute("id",this._img.getAttribute("id")),this._rootObj.className=this._img.className,this._eventObj=this._rootObj;for(var c;c=this._onLoadDelegate.shift();)this._handleRotation(c,!0)}:function(){this._rootObj.setAttribute("id",this._img.getAttribute("id")),this._rootObj.className=this._img.className,this._imgWidth=this._img.naturalWidth,this._imgHeight=this._img.naturalHeight;var a=Math.sqrt(this._imgHeight*this._imgHeight+this._imgWidth*this._imgWidth);this._width=3*a,this._height=3*a,this._aspectW=this._img.offsetWidth/this._img.naturalWidth,this._aspectH=this._img.offsetHeight/this._img.naturalHeight,this._img.parentNode.removeChild(this._img),this._canvas=document.createElement("canvas"),this._canvas.setAttribute("width",this._width),this._canvas.style.position="relative",this._canvas.style.left=-this._img.height*this._aspectW+"px",this._canvas.style.top=-this._img.width*this._aspectH+"px",this._canvas.Wilq32=this._rootObj.Wilq32,this._rootObj.appendChild(this._canvas),this._rootObj.style.width=this._img.width*this._aspectW+"px",this._rootObj.style.height=this._img.height*this._aspectH+"px",this._eventObj=this._canvas,this._cnv=this._canvas.getContext("2d");for(var b;b=this._onLoadDelegate.shift();)this._handleRotation(b,!0)}}(),_animateStart:function(){this._timer&&clearTimeout(this._timer),this._animateStartTime=+new Date,this._animateStartAngle=this._angle,this._animate()},_animate:function(){var a=+new Date,b=a-this._animateStartTime>this._parameters.duration;if(b&&!this._parameters.animatedGif)clearTimeout(this._timer);else{if(this._canvas||this._vimage||this._img){var c=this._parameters.easing(0,a-this._animateStartTime,this._animateStartAngle,this._parameters.animateTo-this._animateStartAngle,this._parameters.duration);this._rotate(~~(10*c)/10)}this._parameters.step&&this._parameters.step(this._angle);var d=this;this._timer=setTimeout(function(){d._animate.call(d)},10)}this._parameters.callback&&b&&(this._angle=this._parameters.animateTo,this._rotate(this._angle),this._parameters.callback.call(this._rootObj))},_rotate:function(){var a=Math.PI/180;return IE?function(a){this._angle=a,this._container.style.rotation=a%360+"deg",this._vimage.style.top=-(this._rotationCenterY-this._imgHeight/2)+"px",this._vimage.style.left=-(this._rotationCenterX-this._imgWidth/2)+"px",this._container.style.top=this._rotationCenterY-this._imgHeight/2+"px",this._container.style.left=this._rotationCenterX-this._imgWidth/2+"px"}:supportedCSS?function(a){this._angle=a,this._img.style[supportedCSS]="rotate("+a%360+"deg)",this._img.style[supportedCSSOrigin]=this._parameters.center.join(" ")}:function(b){this._angle=b,b=b%360*a,this._canvas.width=this._width,this._canvas.height=this._height,this._cnv.translate(this._imgWidth*this._aspectW,this._imgHeight*this._aspectH),this._cnv.translate(this._rotationCenterX,this._rotationCenterY),this._cnv.rotate(b),this._cnv.translate(-this._rotationCenterX,-this._rotationCenterY),this._cnv.scale(this._aspectW,this._aspectH),this._cnv.drawImage(this._img,0,0)}}()},IE&&(Wilq32.PhotoEffect.prototype.createVMLNode=function(){document.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{return!document.namespaces.rvml&&document.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),function(a){return document.createElement("<rvml:"+a+' class="rvml">')}}catch(a){return function(a){return document.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}}())}(jQuery);